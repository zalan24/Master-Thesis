include {
    aglobal;
    fullscreen;
}

descriptor {
    variants {
    }
    resources {
        vec3 eyeDir;
        vec3 sunDir;
        vec3 sunLight;
        vec3 ambientLight;
    }
}

stages {
    ps {
        entry = main;
        use eyeDir;
        use sunDir;
        use sunLight;
        use ambientLight;
    }
}

ps {
    void main() {
        float sunSizeCos = 0.01;

        vec3 view = getViewVec();
        float cosFromSun = dot(-view, PushConstants.sunDir);

        vec3 light = PushConstants.ambientLight * 2;

        if (cosFromSun > 1-sunSizeCos) {
            // looking at the sun
            light += PushConstants.sunLight;
        }
        if (cosFromSun > 0) {
            light += PushConstants.sunLight * cosFromSun * 0.1;
        }

        // light += ;
        outColor = lightToColor(light);
    }
}
